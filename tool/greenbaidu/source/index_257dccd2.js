F.addLog("mantpl:news",{newsShow:"0200100000",recomWordShow:"1100000000",newsClick:"0200100001",hotsugClick:"0200200001",dustbinClick:"page-card-tpl-item",recomWordClick:"page-card-tpl-item",newsBanner:"0200300001",adsNewsFourTimes:"0200300002",adsEngShow:"0200300003",adsEngClick:"0200300004",topNewsImageClick:"0200100002",topNewsTextClick:"0200100003"});F.addLog("mantpl:news/index",["cardItemLog"]);F.module("mantpl:news/index_view",function(e,g,h){var c=e("superui:util/dot");function a(j){var k=this;k.perCount=16;k.passNum=16;k.curRound=1;k.topDom=j;k.ranDom=$(".s-news-rank-content",k.topDom);k.curImgNum=0;k.hotWrap=$(".new-image-pool");k.hotCtrlNum=$(".carousel-ctrl-item",k.topDom).length;k.hotCtrlWid=$(".new-image-pool .img-item",k.topDom).width();k.ctrlWrap=$(".carousel-ctrl")}a.prototype={renderHot:function(r,t,o){var p="";var l=0;var j="";var k=this;k.curRound=t;$(".news-meta-item").removeClass("news-viewed");for(var l=0;l<k.perCount;l++){var n=r[(l+k.passNum)%r.length];var s=n.title;var q=decodeURIComponent(n.url);var o=n.count;var m=k.ranDom.find('[data-index="'+l+'"]');m.removeClass("news-artist").find(".news-title .title-link .title-content").html(s).attr("href",q).end().find(".news-count").html(o).attr("title","搜索指数"+o);k.ranDom.find(".v-detail").remove();if(n.isViewed==1){m.addClass("news-viewed")}if(n.isNew==1){m.addClass("news-artist")}}k.passNum+=k.perCount},longHot:function(j){var k=this;k.perCount=12;k.passNum-=8;$(".s-news-rank-content",k.topDom).addClass("s-news-rank-long");k.renderHot(j,k.curRound)},flashImg:function(k,l){var j=this;if(!j.imgRef){j.imgRef=$(".s-news-img",j.topDom).eq(0);j.imgHeight=j.imgRef.height();j.imgWidth=j.imgRef.width()}if(l==="mouseenter"){$(".s-news-img:animated").stop().css({"margin-top":"0","margin-left":"0",width:j.imgWidth,height:j.imgHeight});k.animate({"margin-top":"-10px","margin-left":"-10px",width:j.imgWidth+20,height:j.imgHeight+20})}else{k.animate({"margin-top":"0","margin-left":"0",width:j.imgWidth,height:j.imgHeight})}},switchHotImg:function(n,m,l){var k=this;if(k.stopSwitch&&!l){return}if(!!m){var j=parseInt(k.curImgNum,10)+n;j=j<0?(j+k.hotCtrlNum):j;k.curImgNum=j%k.hotCtrlNum}else{if(n){k.curImgNum=n}else{k.curImgNum=(parseInt(k.curImgNum,10)+1)%k.hotCtrlNum}}clearTimeout(k.cTimmer);k.ctrlWrap.find(".carousel-ctrl-cur").removeClass("carousel-ctrl-cur").end().find('[data-index="'+k.curImgNum+'"]').addClass("carousel-ctrl-cur");k.hotWrap.stop().animate({left:(-1*k.curImgNum*k.hotCtrlWid)+"px"},function(){k.carousel()})},carousel:function(){var j=this;j.cTimmer=setInterval(function(){j.switchHotImg(1,true)},5000)},createRecom:function(j,k){_ctx=this;$.ajaxpost(s_domain.baseuri+"/news/data/newrelatewords",{title:$.trim($(j).find("h2 .s-yahei").text()),rid:$(j).attr("data-rid")},function(n){var l=n.errNo,q=n.data;if(l=="0"){var p=_ctx.topDom.find(".c-recommend");if(p){p.remove()}var r="";for(var o=0;o<q.length;o++){r=r+'<a href="'+decodeURIComponent(q[o].recomHref)+'" target="_blank" class="recom-link">'+q[o].recomTitle+"</a>"}var m='<div class="c-recommend"><i class="c-icon"></i><span class="c-gray">为您推荐：</span>'+r+"</div>";$(j).find(".from").after(m);k&&k(j)}else{if(l=="501"){}}})},getRecomWords:function(k){var m=[],l=$(k).find(".c-recommend a");for(var j=0;j<l.length;j++){m.push('"'+$.trim($(l[j]).text())+'"')}return m},getEngWords:function(k){var m=[],l=$(k).find(".s-news-content-imgs a");for(var j=0;j<3;j++){m.push($.trim($(l[j]).attr("data-itemId")))}return m},getHotWords:function(){var l=[],k=this.ranDom.find(".title-content");for(var j=0;j<k.length;j++){l.push('"'+$.trim($(k[j]).text())+'"')}return l},waitView:function(l,j,m){var k=this;if(l.type==="mouseenter"){k.ranDom.find(".v-detail").hide();clearTimeout(k.onTimer);clearTimeout(k.offTimer);k.onTimer=setTimeout(function(){j.parents(".news-meta-item");d()},500)}else{if(l.type==="mouseleave"){clearTimeout(k.onTimer);k.hideDetail(j)}}},viewDetail:function(j,o){var m=$.trim($(".title-content",j).html()),k=this;for(var l in o){if(o[l].title===m){o[l].isNew=0;o[l].isViewed=1;break}}var n=$(".s-news-rank-list .one-item",k.topDom).length;$.ajaxget("/home/news/data/mannewssug?word="+m,function(p){if(p.data.length<1){return}var t=j.offset().top-$(".s-news-rank-content",k.topDom).offset().top+20;var r=parseInt(j.closest("[data-index]").attr("data-index"));if(r>7){t-=130}if($.browser.firefox){t+=10}else{if($.isIE==6){t-=3}}var q=f(p.data,t,(r>7),+r%2);if(!!q){var s=$(q);j.append(s);if($.isIE===6){setTimeout(function(){s.css({zoom:1})},200)}}})},showDetail:function(k,l){var j=k.find(".v-detail");k.parents(".s-news-rank-content").find(".v-detail").hide();if(j[0]){j.show()}else{this.viewDetail(k,l)}return true},hideDetail:function(j){j.find(".v-detail").hide()}};function f(m,n,o,l){var k='<div class="v-detail#{down}#{right}" style="top:#{top}px;"><div class="detail-content">#{content}<div class="v-arrow"><em></em></div></div></div>';if(!m||!m.length){return false}var j=b(m[0])+i(m[0])+b(m[1]);return $.formatString(k,{content:j,top:n,down:o?" v-down":"",right:l?" v-right":" v-left"})}function b(k){if(!k){return""}k.url=decodeURIComponent(k.url);var j='<div class="hot-words-item"><span class="dot"></span><a class="word-title" href="#{url}" target="_blank" title="#{realtitle}">#{title}</a></div>';return $.decodeHTML($.formatString(j,k))}function i(k){var j='<div class="hot-words-summary">#{summary}</div>';return $.decodeHTML($.formatString(j,k))}function d(){h.fire("hotsugClick",{clickType:"layerShow",newsType:"words"})}return a});F.module("mantpl:news/index",function(c,g,o){var a=c("superui:util/dot");var l=$.parseJSON($("#news_hot_data").html());var p=$.parseJSON($("#news_banner_data").html());var e=c("mantpl:news/index_view");var i=$("#s_xmancard_news");var f=$(".s-news-banner-wrap");var h=new e(i);var k=2;var n=c("superui:component/tips");var d=new n({target:$("#head"),identity:"ExceedTipsNews",content:"今天召唤我太多次啦，</br>明天再来调教小度吧！`(*∩_∩*)′",timing:2000,autoShow:false,theme:"exceedtipnews"});var j=0;var m=[];function b(){this.onTimer=null;this.offTimer=null;this.hotRound=1}b.prototype={constructor:b,init:function(){this.blockName="news";this.addEvent();this.fix();this.saveFistRids();var q=this.stringify(h.getHotWords());o.fire("newsShow",{showType:"hotword",words:q,pagenum:"0"});$(".s-news-rank-wrapper .s-rank-title").addClass("s-opacity-border1-bottom");this.itemNum=$(".s-news-item").length},stringify:function(q){return"["+q.join(",")+"]"},setTopDom:function(q){i=q},fix:function(){i.find(".s-news-item:eq(0)").addClass("first")},saveFistRids:function(){i.find(".s-news-list-wrapper:first .s-news-item").each(function(){if($(this).attr("data-rid")){m.push($(this).attr("data-rid"))}else{m.push("0")}})},getNotNewsPos:function(r){var q=0;i.find(".s-news-item").each(function(s){if($(this).hasClass(r)){q=s;return false}});return q},showLayer:function(s,r){var t,q=this;if($.isIE6){t=$(window).height()/2+$(window).scrollTop()}else{t="50%"}F.use("superui:component/dialog",function(u){q.DelPannel=new u({identity:"newsDel",content:'<div class="pannel-content">确定不感兴趣吗？</br>以后这类信息会少出现哒！(=￣ω￣=)✧</div>',hasClose:true,theme:q.blockName+"-pannel",autoShow:true,width:400,top:t,dus:r,buttons:[function(v){q.sendTip(v);if($(r).hasClass("extends-dustbin")){q.delExtends(r,1)}else{q.delNew(r)}o.fire("dustbinClick",{nodename:"ok"})},function(){o.fire("dustbinClick",{nodename:"cancel"})}]});if($.isIE===6){$("#sui-dialog-mask").height($(document.body).height())}});$(".sui-dialog-footer").prepend('<a href="javascript:;" onclick="return false;" class="noremind"><i class="checkbox"></i>不再提示</a>');if(s=="1"||s=="2"){$(".checkbox").addClass("checkboxbk")}$(".sui-dialog-news-pannel").delegate(".noremind","click",function(u){$(".checkbox").toggleClass("checkboxbk");o.fire("dustbinClick",{nodename:"noremind"});u.stopPropagation()})},sendTip:function(r){var q=r.target.prev().find(".checkbox");if(q.hasClass("checkboxbk")){F.use("superman:common/user_attr",function(s){s.setAttr("delrecLayer","1")})}else{F.use("superman:common/user_attr",function(s){s.setAttr("delrecLayer","0")})}},delNew:function(q){_ctx=this;$.ajaxpost(s_domain.baseuri+"/news/submit/mannewsoperation",{cmd:"remove",id:$(q).parents(".s-news-item").attr("data-rid")},function(s){var r=s.errNo;if(r=="0"){var t=$(q).parents(".s-news-item");var u=t.parents(".s-news-list-wrapper");t.remove();if(u.children().length==0){u.remove()}$(".s-news-list-wrapper .s-news-item:first").addClass("first");_ctx.itemNum--;if(_ctx.itemNum<7){F.call("mancard:skeleton/presenter","judgeFire")}}else{if(r=="501"){d.show();if($.isIE6){d.tips.css({top:$(window).height()/2+$(window).scrollTop()})}else{d.tips.css({top:"50%"})}}}})},delExtends:function(q,r){_ctx=this;$.ajaxpost(s_domain.baseuri+"/other/submit/setadstatus",{sortname:"adsNewsFour",aid:$(q).attr("data-aid")},function(t){var s=t.errNo;$.localstorage.remove("adsNewsFourTimes");if(s=="0"&&r){var u=$(q).parents(".s-news-item");var v=u.parents(".s-news-list-wrapper");u.remove();if(v.children().length==0){v.remove()}$(".s-news-list-wrapper .s-news-item:first").addClass("first");_ctx.itemNum--;if(_ctx.itemNum<7){F.call("mancard:skeleton/presenter","judgeFire")}o.fire("adsNewsFourTimes",{clickType:"close"})}else{if(s=="501"){d.show();if($.isIE6){d.tips.css({top:$(window).height()/2+$(window).scrollTop()})}else{d.tips.css({top:"50%"})}}}})},decreaseExtends:function(){var q=this;var r=i.find(".extends-dustbin");var s=r.closest(".s-news-item");if(r.length){o.fire("adsNewsFourTimes",{clickType:"show"});var t=r.attr("data-aid");if($.localstorage.get("adsNewsFourAid").value!=t){$.localstorage.remove("adsNewsFourTimes");$.localstorage.set("adsNewsFourAid",t)}if($.localstorage.get("adsNewsFourTimes").value=="NaN"){$.localstorage.set("adsNewsFourTimes",r.attr("data-times"))}else{if($.localstorage.get("adsNewsFourTimes").value){$.localstorage.set("adsNewsFourTimes",parseInt($.localstorage.get("adsNewsFourTimes").value)-1)}else{$.localstorage.set("adsNewsFourTimes",r.attr("data-times"))}}if($.localstorage.get("adsNewsFourTimes").value<="1"){q.delExtends(r);return}}},addEvent:function(){var q=this;var u=$(".s-news-list-wrapper",i);var t;i.delegate(".s-news-item","mouseenter",function(v){if($.isIE===6){$(".dustbin",this).css("display","block")}v.stopPropagation()}).delegate(".s-news-item","mouseleave",function(v){if($.isIE===6){$(".dustbin",this).css("display","none")}v.stopPropagation()}).delegate(".dustbin","click",function(v){_ctxdus=this;$.ajaxget(s_domain.baseuri+"/other/data/mancardlayer?tabid="+window.s_session.curmod,function(x){var w=x;if(w.showFloat=="0"){if($(_ctxdus).hasClass("extends-dustbin")){q.delExtends(_ctxdus,1)}else{q.delNew(_ctxdus)}}else{q.showLayer(w.noremind,_ctxdus)}});t&&t.close();v.stopPropagation()}).delegate(".dustbin","mouseenter",function(v){_ctxdus=$(this);t=new n({target:_ctxdus,identity:"noInterestTipsNews",content:"不感兴趣",autoShow:true,arrowUp:false,arrowLeft:"center",align:"center",theme:"nointeresttipnews"});$(".sui-tips-nointeresttipnews").css({top:"+=2"});v.stopPropagation()}).delegate(".dustbin","mouseleave",function(v){t&&t.close();v.stopPropagation()}).delegate(".s-news-item a[href]","click",function(w){if(!$(this).attr("data-src")){var v=$(this).parents(".s-news-item");v.addClass("news-viewed");if(s_session.sid.indexOf("18836")>-1&&v.attr("data-relatewords")&&$(this).find(".from")){h.createRecom(v,function(y){var x=q.stringify(h.getRecomWords(y));o.fire("recomWordShow",{opType:"recomshow",rid:y.attr("data-rid"),words:x})});q.sendRecomLog(v)}}w.stopPropagation()}).delegate(".s-news-item a[href]","mousedown",function(x){var w=$(this).parents(".s-news-item");if(!$(this).attr("data-src")){if(!/pos-0/g.test(w.attr("data-log"))){w.attr("data-log",w.attr("data-log")+"pos-0:"+m.indexOf(w.attr("data-rid"))+";")}if(w.find(".dustbin").hasClass("extends-dustbin")){var v=w.find(".s-text-content h2 a");o.fire("adsNewsFourTimes",{clickType:"click",url:v.attr("href")})}if(w.hasClass("eng-hot-word")){o.fire("adsEngClick",{clickType:"click",itemId:$(this).attr("data-itemId")||w.attr("data-itemId"),url:$(this).attr("href"),pos:q.getNotNewsPos("eng-hot-word"),subpos:$(this).attr("data-pos"),title:$.trim($(this).find(".s-news-text").text())||$(this).attr("title")})}}else{if(w.hasClass("eng-hot-word")){o.fire("adsEngClick",{clickType:"srcClick",url:$(this).attr("href"),pos:q.getNotNewsPos("eng-hot-word"),title:$.trim($(this).text()),itemId:w.attr("data-itemId")})}}}).delegate(".s-news-rank-wrapper .hot-refresh","click",function(w){h.renderHot(l.banner,q.hotRound++);o.fire("newsClick",{clickType:"wordsChange"});j++;var v=q.stringify(h.getHotWords());o.fire("newsShow",{showType:"hotword",words:v,pagenum:j})}).delegate(".news-title .title-link","mouseenter mouseleave",function(v){h.waitView(v,$(this),l.banner);v.stopPropagation()}).delegate(".news-title .title-link a","click",function(x){$(this).parents(".news-meta-item").removeClass("news-viewed").removeClass("news-artist").addClass("news-viewed");var w=$.trim($(this).html());$.ajaxpost("/home/news/submit/mannewsview",{title:w});for(var v in l.banner){if(l.banner[v].title==$.decodeHTML($.trim($(this).html()))){l.banner[v].isViewed=1;l.banner[v].isNew="0"}}}).delegate(".title-content","click",function(w){var v=$(this);o.fire("newsClick",{clickType:"wordTopic",newsType:"words",url:$(this).attr("href"),title:$(this).text(),pagenum:j,newsindex:$(this).closest(".news-meta-item").attr("data-index")});w.stopPropagation()}).delegate(".word-title","click",function(w){var v=$(this);o.fire("hotsugClick",{clickType:"wordTopic",newsType:"words",url:$(this).attr("href")});w.stopPropagation()}).delegate(".title-text a","click",function(v){o.fire("hotsugClick",{clickType:"wordTopic",newsType:"topLink",url:$(this).attr("href")})}).delegate("s_news_banner","click",function(v){o.fire("hotbannerClick",{clickType:"",newsType:"topLink",url:$(this).attr("href")})}).delegate(".s-news-banner-wrap","click",function(){o.fire("newsBanner",{clickType:"click",url:p.url,title:p.title,bannerId:p.bannerId})}).delegate(".s-text-banner [data-click]","click",function(v){o.fire("topNewsTextClick",{clickType:$(this).attr("data-click"),url:$(this).attr("href")||$(this).parent().attr("href")});v.stopPropagation()}).delegate(".s-image-banner [data-click]","click",function(v){o.fire("topNewsImageClick",{clickType:$(this).attr("data-click"),url:$(this).attr("href")||$(this).parent().attr("href")});v.stopPropagation()});if($.isIE!==6){q.browserFollow()}else{q.ieFollow()}var r=false;var s=false;o.listen("mancard:skeleton/card","cardloaded",function(z){if(z.loadData.rids){for(var y=0;y<z.loadData.rids.length;y++){m.push(z.loadData.rids[y])}}if(+z.cardId===+k){i.removeClass("s-news-split")}if(z.cardId==k&&(!s)){s=true;q.decreaseExtends();if(i.find(".s-news-item.eng-hot-word").length){var x=true;var A=i.find(".s-news-item.eng-hot-word");$(window).on("scroll",function(){if(($(window).height()+$(document).scrollTop())>=(A.offset().top+A.height()/2)&&x){setTimeout(function(){var B=q.stringify(h.getEngWords(A));if($(A).hasClass("eng-word")){o.fire("adsEngShow",{showType:"show",pos:q.getNotNewsPos("eng-hot-word"),itemId:B})}else{o.fire("adsEngShow",{showType:"show",pos:q.getNotNewsPos("eng-hot-word"),itemId:$(A).attr("data-itemId")})}x=false},100);x=false}})}}if(z.cardId==k&&h.perCount!=12&&z.loadData.isEnd=="0"){q.itemNum+=5;if(!r){r=true;if(p&&!!(+p.isViewed)){var w=$.url.escapeSSL(decodeURIComponent(p.img));f.css("background","url("+w+") no-repeat");f.removeClass("news-banner-hidden");o.fire("newsBanner",{clickType:"show",title:p.title,bannerId:p.bannerId})}}else{h.renderHot(l.banner,q.hotRound++);var v=q.stringify(h.getHotWords());j++;o.fire("newsShow",{showType:"hotword",words:v,pagenum:j})}i.attr("data-waterpara","version="+z.loadData.version+";"+z.loadData.waterpara)}});o.listen("superui:component/dialog","dialogHide",function(x){var w=x.obj.options("dus");if($.isIE===6){var v=$(w).parents(".item-wrapper");$(w).css("display","none");$(".subscribe",v).css("display","none");$(".img-click",v).css("display","block")}})},roller:function(r,q,u,w){if(!this.nWrap){this.nWrap=$(".s-news-wrapper",i);this.nOffset=this.nWrap.offset()}var y=this.nWrap;var v=r.offset();var x=r.height();var t=i.width();var s=this.nOffset;if(y.offset().top-(v.top+x)<w&&u&&i.is(":visible")){q.css({position:"fixed",top:Math.min(x+w,y.height()+s.top-$(window).scrollTop()-q.outerHeight(true)),right:($(window).width()-(s.left+t)-20+$(window).scrollLeft())})}else{q.css({position:"absolute",top:0,right:"5px"})}},browserFollow:function(){var u=$(".s-news-rank-wrapper",i);var t=$("#s_top_wrap");var r=this;var s=false;function q(v){if(!t.find("#s_menu_gurd")[0]){r.roller(t,u,s,15)}else{r.roller(t,u,s,30)}}o.listen("superman:page/scroll","outMenu",function(v){if(v.out===true){s=true;$(window).bind("scroll",q);$(window).bind("resize",q)}else{s=false;$(window).unbind("scroll",q);$(window).unbind("resize",q);u.removeAttr("style")}});$(window).bind("resize",function(){if(!r.nWrap){r.nWrap=$(".s-news-wrapper",i)}r.nOffset=r.nWrap.offset()});o.listen("mancard:skeleton/presenter","switchCard",function(v){if(+v.toCard===k){if(!r.nWrap){r.nWrap=$(".s-news-wrapper",i)}r.nOffset=r.nWrap.offset()}})},ieFollow:function(){var u=$(".s-news-rank-wrapper",i);var r=$("#s_ctner_contents");var q=0;var s=u.height();function t(){if($(this).scrollTop()>q){_top=Math.min(Math.max($(this).scrollTop()-322,0),Math.abs(r.height()-s-100))}else{_top=Math.min(Math.max($(this).scrollTop()-290,0),Math.abs(r.height()-s-100))}u.stop().animate({top:_top});q=$(this).scrollTop()}$(window).bind("scroll",t)},sendRecomLog:function(r){var q=this;var s;r.delegate(".recom-link","click",function(u){$(this).css("color","#666");var t=q.stringify(h.getRecomWords(r));o.fire("recomWordClick",{nodename:"recomLink",url:$(this).attr("href")||"",title:$.trim($(this).text())||"",rid:r.attr("data-rid"),words:t});u.stopPropagation()}).delegate(".recom-link","mouseenter",function(u){var t=this;s=setTimeout(function(){var v=q.stringify(h.getRecomWords(r));o.fire("recomWordShow",{onType:"hover",url:$(t).attr("href")||"",title:$.trim($(t).text())||"",rid:r.attr("data-rid"),words:v})},500);u.stopPropagation()}).delegate(".recom-link","mouseleave",function(t){clearTimeout(s)})}};return new b()});F.use("mantpl:news/index",function(a){a.init()});